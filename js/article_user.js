function del(b){var c=b.split('_');if(!confirm('Are you sure you want to delete this '+c[1]+'?'))return false;$.post('/delete',{'id':b},function(a){if(a!=''){alert(a)}else{$('#'+c[1]+'_'+c[2]).fadeOut("slow",function(){$(this).remove()});$('#num_comments span').html(parseInt($('#num_comments span').html())-1)}})}function edit_comment(b){$.post('/edit_comment',{'ci':b,'comment':$('textarea[name=edit]').val()},function(a){if(a.message==''){$('form[name=edit]').before(a.html).remove();$('#edit_comment_'+b).unbind('click');$('#edit_comment_'+b).html('Edit');$('#edit_comment_'+b).click(function(){show_hide_edit_form(this.id);return false});$('form[name=edit]').unbind('submit');$('#del_comment_'+b).unbind('click')}else{$('#edit_err').html(a.message)}},"json")}function fav(b){var b=b.split('_');$.post('/favorite',{'id':b[1]},function(a){if(a!=''){alert(a)}else{$('#fav_'+b[1]).html('Added to Favorites');$('#fav_'+b[1]).unbind('click')}})}function get_participants(b){var c=b.split('_');$('#part_container').css('display','block');$('#part_container').html('<img src="/img/load.gif" alt="Loading..."/>');$.get('/participants',{'sid':c[1]},function(a){$('#part_container').html(a);$('#part_holder').fadeOut("slow",function(){$(this).remove()})})}function post_comment(b,c,d){var e=(d)?d.split('_'):'';var f=(e=='')?'':e[1];$('input[type=submit]').parent().append(' <img id="loading" src="/img/load.gif" alt="Loading..."/>');$.post('/comment',{'si':b,'rt':f,'comment':$('textarea[name='+c+']').val()},function(a){$('form img').remove();if(a.message==''){if(c=='reply'){if($('#replies_to_'+f).length>0){$('#replies_to_'+f).append(a.html)}else{$('#'+d).parent().parent().parent().parent().append('<ul id="replies_to_'+f+'">'+a.html+'</ul>')}remove_form(b,d)}else{$('#comment_err div').remove();$('#no_comment').remove();$('textarea[name=comment]').attr('value','');$('#comments').append(a.html);$('#r_'+a.id).click(function(){show_hide_reply_form(b,this.id);return false})}switch($('#num_comments span').html()){case'0':$('#num_comments').html('<span>1</span> Comment');break;case'1':$('#num_comments').html('<span>2</span> Comments');break;default:$('#num_comments span').html(parseInt($('#num_comments span').html())+1);break}$('#comment_'+a.id+' abbr.timeago').timeago();$('#promote_comment_'+a.id).click(function(){vote(this.id);return false});$('#demote_comment_'+a.id).click(function(){vote(this.id);return false});$('#edit_comment_'+a.id).click(function(){show_hide_edit_form(this.id);return false})}else{$('#'+c+'_err').html(a.message)}},"json")}function remove_edit_form(a){var b=a.split('_');$('form[name=edit]').unbind('submit');$('form[name=edit]').unbind('growfield');$('form[name=edit]').unbind('spellcheck');$('form[name=edit]').before('<div id="comment_detail_'+b[2]+'">'+$('#edit_old_'+b[2]+'').html()+'</div>').remove();$('#'+a).html('Edit');$('#'+a).unbind('click');$('#del_comment_'+b[2]).unbind('click');$('#'+a).click(function(){show_hide_edit_form(this.id);return false})}function remove_form(a,b){$('form[name=reply]').unbind('submit');$('form[name=reply]').unbind('growfield');$('form[name=reply]').unbind('spellcheck');$('form[name=reply]').remove();$('#'+b).html('Reply');$('#'+b).unbind('click');$('#'+b).click(function(){show_hide_reply_form(a,this.id);return false})}function report_abuse(b){var c=b.split('_');$.post('/report_abuse',{'id':b},function(a){if(a.message==''){$('#'+b).html('Reported');$('#'+b).unbind('click')}else{alert(a.message)}},"json")}function show_hide_edit_form(a){var b=a.split('_');if($('#'+a).html()=='Edit'){$('form[name=edit]').unbind('submit');$('form[name=edit]').remove();$('.edit').html('Edit');$('.edit').unbind('click');$('.edit').click(function(){show_hide_edit_form(this.id);return false});var c=$('#comment_detail_'+b[2]).html().replace(/<br>/gi,"\n").replace(/<\/?[^>]+(>|$)/g,"");$('#comment_detail_'+b[2]).before('<form action="#" method="post" name="edit" style="margin-left:0">'+'<h4>Edit<span> &#151; No HTML Please.</span></h4>'+'<textarea name="edit">'+c+'</textarea>'+'<div id="edit_err"></div>'+'<input type="submit" value="Save"/>'+'<a id="del_comment_'+b[2]+'" class="del_comment" href="#">Delete Comment</a>'+'</form>'+'<div id="edit_old_'+b[2]+'" style="display:none">'+$('#comment_detail_'+b[2]).html()+'</div>').remove();$('textarea[name=edit]').spellcheck();$('textarea[name=edit]').growfield({'min':150});$('#del_comment_'+b[2]).click(function(){del(this.id);return false});$('form[name=edit]').submit(function(){edit_comment(b[2]);return false});$('#'+a).html('Cancel Edit');$('#'+a).click(function(){remove_edit_form(this.id);return false})}}function show_hide_reply_form(a,b){var c=b.split('_');if($('#'+b).html()=='Reply'){$('form[name=reply]').unbind('submit');$('form[name=reply]').remove();$('.reply').html('Reply');$('.reply').unbind('click');$('.reply').click(function(){show_hide_reply_form(a,this.id);return false});$('#'+b).parent().parent().append('<form action="#" method="post" name="reply">'+'<h4>Reply<span> &#151; No HTML Please.</span></h4>'+'<textarea name="reply"></textarea>'+'<div id="reply_err"></div><br/>'+'<input type="submit" value="Post Reply"/>'+'</form>');$('textarea[name=reply]').spellcheck();$('textarea[name=reply]').growfield({'min':150});$('form[name=reply]').submit(function(){post_comment(a,'reply',b);return false});$('#'+b).html('Cancel Reply');$('#'+b).click(function(){remove_form(a,this.id);return false})}}function vote(b){var c=b.split('_');var d=$('#'+c[1]+'-pop-'+c[2]).html();$('#'+c[1]+'-pop-'+c[2]).html('<img src="/img/load.gif" alt="Loading..."/>');$.post('/vote',{'id':b},function(a){if(a.message==''){$('#'+c[1]+'_'+c[2]).removeClass('demoted');$('#promote_'+c[1]+'_'+c[2]).removeClass('promoted');switch(a.value){case'1':$('#promote_'+c[1]+'_'+c[2]).addClass('promoted');break;case'-1':$('#'+c[1]+'_'+c[2]).addClass('demoted');break;default:break}$('#'+c[1]+'-pop-'+c[2]).fadeOut('fast',function(){$('#'+c[1]+'-pop-'+c[2]).html(a.vote_count).fadeIn('fast')})}else{$('#'+c[1]+'-pop-'+c[2]).fadeOut('fast',function(){$('#'+c[1]+'-pop-'+c[2]).html(d).fadeIn('fast')});alert(a.message)}},"json")}